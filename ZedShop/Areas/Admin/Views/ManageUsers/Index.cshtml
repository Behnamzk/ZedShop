@model List<ZedShop.Web.Areas.Admin.Models.UserViewModel.UserViewModel>
@{
    ViewData["Title"] = "مدیریت کاربران";
    Layout = "~/areas/admin/views/shared/_AdminLayout.cshtml";
}

@* @if (TempData["StatusMessage"] != null) https://localhost:7062/Admin/ManageUsers/Index
{
    <div class="alert alert-success text-center" role="alert">
        @TempData["StatusMessage"]
    </div>
} *@
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div style="display:flex;">

                    <p class="card-title"> <strong>کاربران</strong> </p>

                    <p class="card-title" style="margin-top:15px;margin-right:2%;font-size:16px; "> دسته‌بندی:  </p>
                    <select id="role-select" style="margin-right:5px; width:15%" onclick="LoadUserByRoleFilter()">

                        <option value="-1">همه کاربران</option>
                        @foreach (var item in ViewBag.Roles)
                        {
                            <option value="@item.Id">@item.Name</option>
                        }
                      
                    </select>

                    <p class="card-title" style="margin-top:15px;margin-right:2%;font-size:16px; "> فیلتر:  </p>
                    <select id="filter-select" style="margin-right:5px; width:15%" onclick="LoadUserByRoleFilter()">

                        @foreach (var item in ViewBag.Filters)
                        {
                            <option value="@item.Id">@item.Name</option>
                        }

                    </select>

                </div>


                @if (ViewBag.Message != null)
                {
                    @foreach (var item in ViewBag.Message)
                    {
                        <div class="alert alert-info">
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">×</span> </button>
                            <h3 class="text-info"><i class="fa fa-exclamation-circle"></i> Information</h3>
                            @item
                        </div>
                    }
                }
                <div id="basicgrid" class="m-t-40 jsgrid" style="position: relative; height: 750px; width: 100%;">
                    <div class="jsgrid-grid-header jsgrid-header-scrollbar">
                        <table class="jsgrid-table table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th style="width:10%">
                                        نام کاربری
                                    </th>
                                    <th style="width:18%">
                                        ایمیل
                                    </th>
                                    <th style="width:8%; text-align:center;">
                                        نقش کاربری
                                    </th>
                                    <th style="width:5%; text-align:center;">
                                        جنسیت
                                    </th>
                                    <th style="width:5%; text-align:center;">
                                        تایید ایمیل
                                    </th>
                                    <th style="width:5%; text-align:center;">
                                        مسدود
                                    </th>
                                    <th style="width:20%; text-align:center;">
                                        اقدامات
                                    </th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div id="tableofusercontent">
                        @Html.Partial("_UsersTable")
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<script>
    function updateTableData(roleId, filterId, pageNum) {
        $.ajax({
            url: '/Admin/ManageUsers/ChangePage/', // controller and action
            data: { _roleId: roleId, _filterId: filterId, pageNumber: pageNum, }, // Send the userInput as a parameter
            dataType: 'html',
            success: function (data) {

                $('#tableofusercontent').html(data); // Insert the received HTML into the container
            }
        });
    }

</script>


<script>
    function DeleteUser(id) {
        if (confirm("آیا از حذف مطمین هستید؟")) {
            $.get("/Admin/ManageUsers/DeleteUser/" + id,
                function () {
                    var myobj = document.getElementById(id);
                    myobj.remove();
                });
        }
    }

    function BanUser(id) {
        if (confirm("آیا از مسدود کردن کاربر مطمین هستید؟")) {
            console.log("deeff", id);

            $.get("/Admin/ManageUsers/BanUser/" + id,
                function (response) {
                    console.log("deeff", response);
                    var myobj = document.getElementById('ban_' + id);
                    if (response.resault) {
                        myobj.textContent = "بله";
                    } else {
                        myobj.textContent = "خیر";
                    }


                });
        }
    }

</script>

<script>
    function LoadUserByRoleFilter() {

        var selectElement = document.getElementById("role-select");
        var filterElement = document.getElementById("filter-select");

        let id1 = selectElement.value;
        let id2 = filterElement.value;

        $.ajax({
            url: '/Admin/ManageUsers/AllUsersOfRoleFilter/', //controller and action
            data: { _roleId: id1, _filterId: id2 }, // Send the product ID as a parameter
            dataType: 'html',
            success: function (data) {
                $('#tableofusercontent').html(data); // Insert the received HTML into the container
            }
        });
    }
</script>